/*!
 * Start Bootstrap - SB Admin 2 v3.3.7+1 (http://startbootstrap.com/template-overviews/sb-admin-2)
 * Copyright 2013-2017 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap/blob/gh-pages/LICENSE)
 */
$(function(){var serverBasic="",trTemplate='<tr class="odd gradeX">\n                            <td>{{Cost}}</td>\n                            <td>{{Sql}}</td>\n                            <td>{{Date}}</td>\n                            <td><input type="button" value="view" class="btn btn-default btn-sm btn-sql-view"  data-toggle="modal" data-target="#sqlModal" data-info="{{Detail}}"></td>\n                        </tr>';$(".btn-load-sql-agent").click(function(){$.get(serverBasic+"sql_stat/load_agent/"+$("#vm-id").val(),function(response){response=eval("("+response+")"),"success"==response.status?(console.log(response.message),alert("成功载入sql agent")):(console.log(response.message),alert("载入失败"))})}),$('a[data-id="sql-panel"]').click(function(){$.get(serverBasic+"sql_stat/is_load_agent/"+$("#vm-id").val(),function(response){response=eval("("+response+")"),dealBtnAndLoadList(response.status,response.message)})}),$(".vm-list").on("click",".vm-title",function(){var vmId=$(this).attr("data-vm-id");$.get(serverBasic+"sql_stat/is_load_agent/"+vmId,function(response){response=eval("("+response+")"),dealBtnAndLoadList(response.status,response.message)})});var dealBtnAndLoadList=function(t,s){"success"==t?"true"==s?($(".btn-load-sql-agent").addClass("disabled"),$(".btn-load-sql-agent").attr("disabled","true"),$(".btn-load-sql-list").removeClass("disabled"),$(".btn-load-sql-list").removeAttr("disabled"),loadSqlList()):($(".btn-load-sql-agent").removeClass("disabled"),$(".btn-load-sql-agent").removeAttr("disabled"),$(".btn-load-sql-list").addClass("disabled"),$(".btn-load-sql-list").attr("disabled","true")):($(".btn-load-sql-agent").addClass("disabled"),$(".btn-load-sql-agent").attr("disabled","true"),$(".btn-load-sql-list").addClass("disabled"),$(".btn-load-sql-list").attr("disabled","true"))},loadSqlList=function(){$.get(serverBasic+"sql_stat/load_sql_list/"+$("#vm-id").val()+"/10/0",function(response){response=eval("("+response+")");var data=response.data;$("#sql-list").html("");for(var i=0;i<data.length;i++){var cost=data[i].cost,sql=data[i].sql,date=new Date(data[i].date.time).format("yyyy-MM-dd HH:mm:ss.S"),temp=trTemplate.replace(/{{Cost}}/g,cost+"ms").replace(/{{Sql}}/g,sql).replace(/{{Date}}/g,date);$("#sql-list").append(temp)}})};Date.prototype.format=function(t){var s={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var e in s)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?s[e]:("00"+s[e]).substr((""+s[e]).length)));return t}});